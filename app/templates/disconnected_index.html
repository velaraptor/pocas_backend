{% extends 'admin/master.html' %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

{% endblock %}


{% block body %}
<h2>Alarms Dashboard</h2>
<h3 class="text-warning">Services Disconnected: {{ data.stats.services }} </h3>
<hr>
<div class="row">
    <div class="col-md-6">
        <h4>Unique Tags</h4>
        <canvas id="pieChart"></canvas>

    </div>

    <div class="col-md-6">
        <h4>Services NOT Connected to Questions</h4>
        <table class="table table-striped table-bordered table-hover model-list">
          <thead class="table-warning">
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Tags</th>
            </tr>
          </thead>
          <tbody>
          {% for service in data.services %}
            <tr>
            <tr>

              <th scope="row">
                  <a class="icon" href="/admin/servicesview/edit/?id={{ service.service_id }}" title="Edit Service">
                      <span class="fa fa-pencil glyphicon glyphicon-pencil"></span>
                  </a>
                  {{ service.service }}
              </th>
              <td>
                  {% for tag in service.tags %}
                  {{ tag }}
              {% endfor %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
    </div>
</div>

<script>
      const ctx = document.getElementById('pieChart');
      const data = {
      labels: [
        {% for tag in data.tags %}
            '{{ tag.name }}',
            {% endfor %}
      ],
      datasets: [{
        label: 'Services',
        data:
        [
        {% for tag in data.tags %}
            {{ tag.value }},
            {% endfor %}
        ]
        ,
        hoverOffset: 4
      }]
    };


      new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            plugins: {
              datalabels: {
                color: '#fff',
                display: true,
                formatter: function (value, ctx) {
                    return value;
                    },
              },
            },
        }
        });
</script>

{% endblock %}